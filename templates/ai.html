<!DOCTYPE html>
<html>
<head>
    <title>AI Chat</title>
</head>
<body>
<h1>AI Chat</h1>
<textarea id="userInput" rows="4" cols="50"></textarea><br>
<button onclick="sendMessage()">Send</button>
<p id="response"></p>

<script>
async function sendMessage() {
    const message = document.getElementById('userInput').value;
    const res = await fetch('/ai/chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({message})
    });
    const data = await res.json();
    document.getElementById('response').innerText = data.reply;
}
</script>
</body>
</html>


<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŒ± Soil System Dashboard</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { display: flex; height: 100vh; margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .sidebar { width: 220px; background-color: #2e7d32; color: white; padding: 20px; display: flex; flex-direction: column; flex-shrink: 0; }
        .sidebar h3 { margin-bottom: 20px; text-align: center; }
        .sidebar a { color: white; text-decoration: none; cursor: pointer; margin: 8px 0; padding: 12px; border-radius: 8px; transition: background 0.2s; }
        .sidebar a:hover, .sidebar a.active { background-color: #1b5e20; }
        .main { flex-grow: 1; padding: 25px; background-color: #f1f8e9; overflow-y: auto; }
        .page { display: none; } .page.active { display: block; }
        .view-container { display: none; } .view-container.active { display: block; }
        .card { border: none; border-radius: 15px; box-shadow: 0px 10px 30px rgba(0,0,0,0.08); }
        .result-card { margin-top: 30px; padding: 20px; border-radius: 10px; background-color: #e8f5e9; text-align: center; border: 2px dashed #2e7d32; display: none; }
    </style>
</head>
<body>

    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <h3>ðŸŒ± Soil System</h3>
        <a id="nav-dashboard" onclick="showPage('dashboard')" class="active">Dashboard</a>
        <a id="nav-sensor_history" onclick="showPage('sensor_history')">Sensor History</a>
        <a id="nav-crop" onclick="showPage('crop')">Crop Recommend</a>
        <a id="nav-fertilizer" onclick="showPage('fertilizer')">Fertilizer</a>
        <a id="nav-pump" onclick="showPage('pump')">Pump Control</a>
        <a id="nav-water_history" onclick="showPage('water_history')">Water History</a>
        <a id="nav-plant" onclick="showPage('plant')">Plant Details</a>
    </div>

    <!-- Main Content Area -->
    <div class="main">
        <!-- All page HTML structures go here, just as before -->
        
        <!-- ====================================================== -->
        <!-- PAGE 1: DASHBOARD                                      -->
        <!-- ====================================================== -->
        <div id="dashboard-page" class="page active">
            <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-white rounded shadow-sm">
                <div><h5>Weather (Bengaluru)</h5><p id="weather-indicator" class="mb-0 fs-5">Loading...</p></div>
                <div class="text-end"><h5>Date & Time</h5><p id="live-date-time" class="mb-0 fs-5">Loading...</p></div>
            </div>
            <div class="row g-4">
                <div class="col-xl-2 col-lg-4 col-md-6"><div class="card text-center h-100"><div class="card-body d-flex flex-column justify-content-center"><h6 class="card-subtitle text-muted">Temperature</h6><p id="temp-value" class="fs-3 fw-bold text-success mb-0">-- Â°C</p></div></div></div>
                <div class="col-xl-2 col-lg-4 col-md-6"><div class="card text-center h-100"><div class="card-body d-flex flex-column justify-content-center"><h6 class="card-subtitle text-muted">Humidity</h6><p id="humidity-value" class="fs-3 fw-bold text-success mb-0">-- %</p></div></div></div>
                <div class="col-xl-2 col-lg-4 col-md-6"><div class="card text-center h-100"><div class="card-body d-flex flex-column justify-content-center"><h6 class="card-subtitle text-muted">Soil pH</h6><p id="ph-value" class="fs-3 fw-bold text-success mb-0">--</p></div></div></div>
                <div class="col-xl-2 col-lg-4 col-md-6"><div class="card text-center h-100"><div class="card-body d-flex flex-column justify-content-center"><h6 class="card-subtitle text-muted">Nitrogen (N)</h6><p id="n-value" class="fs-3 fw-bold text-success mb-0">--</p></div></div></div>
                <div class="col-xl-2 col-lg-4 col-md-6"><div class="card text-center h-100"><div class="card-body d-flex flex-column justify-content-center"><h6 class="card-subtitle text-muted">Phosphorus (P)</h6><p id="p-value" class="fs-3 fw-bold text-success mb-0">--</p></div></div></div>
                <div class="col-xl-2 col-lg-4 col-md-6"><div class="card text-center h-100"><div class="card-body d-flex flex-column justify-content-center"><h6 class="card-subtitle text-muted">Potassium (K)</h6><p id="k-value" class="fs-3 fw-bold text-success mb-0">--</p></div></div></div>
            </div>
        </div>

        <!-- ... (All other page divs like history, crop, fertilizer, etc., remain exactly the same) ... -->

    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- All JavaScript Logic -->
    <script>
        let historyChart, waterHistoryChart, plantSimInterval;

        // --- SPA NAVIGATION ---
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
            document.getElementById(pageId + '-page').classList.add('active');
            document.getElementById('nav-' + pageId).classList.add('active');

            if (pageId === 'sensor_history') fetchSensorHistory(); // Fetch REAL data
            if (pageId === 'water_history') fetchWaterHistory();   // Fetch REAL data
            if (pageId === 'plant') startPlantSimulation();
            else clearInterval(plantSimInterval);
        }

        // --- DASHBOARD FUNCTIONS (CORRECTED) ---
        function updateDashboard() {
            // Update time
            const now = new Date();
            document.getElementById('live-date-time').innerText = now.toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            
            // NOTE: Add your /api/weather endpoint in app.py to get real weather
            document.getElementById('weather-indicator').innerText = `28.5Â°C, Partly Cloudy`; 

            // **FETCH REAL DATA**: Get the latest sensor readings from the server
            fetch('/api/latest_reading')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.warn("Could not fetch latest data:", data.error);
                        return; // Don't update if there's no data
                    }
                    // Update the dashboard with live values from the database
                    document.getElementById('temp-value').innerText = `${data.temperature.toFixed(1)} Â°C`;
                    document.getElementById('humidity-value').innerText = `${data.humidity.toFixed(1)} %`;
                    document.getElementById('ph-value').innerText = data.ph.toFixed(2);
                    document.getElementById('n-value').innerText = data.N;
                    document.getElementById('p-value').innerText = data.P;
                    document.getElementById('k-value').innerText = data.K;
                })
                .catch(error => console.error("Error fetching live data:", error));
        }

        // --- SENSOR HISTORY FUNCTIONS (CORRECTED) ---
        function fetchSensorHistory() {
            fetch('/api/sensor_history')
                .then(response => response.json())
                .then(data => {
                    if (data && data.length > 0) {
                        renderHistoryChart(data);
                        populateHistoryTable(data);
                    } else {
                        console.log("No sensor history to display.");
                    }
                });
        }
        function renderHistoryChart(data) {
            if (historyChart) historyChart.destroy();
            const ctx = document.getElementById('historyChart').getContext('2d');
            historyChart = new Chart(ctx, { type: 'line', data: { labels: data.map(d => new Date(d.timestamp).toLocaleString()), datasets: [{ label: 'Temperature (Â°C)', data: data.map(d => d.temperature), borderColor: '#dc3545' }, { label: 'Humidity (%)', data: data.map(d => d.humidity), borderColor: '#0d6efd' }] }});
        }
        function populateHistoryTable(data) {
            const tableBody = document.getElementById('history-table-body');
            tableBody.innerHTML = '';
            [...data].reverse().forEach(r => { // Show newest first
                tableBody.innerHTML += `<tr><td>${new Date(r.timestamp).toLocaleString()}</td><td>${r.temperature}</td><td>${r.humidity}</td><td>${r.ph}</td><td>${r.N}</td><td>${r.P}</td><td>${r.K}</td></tr>`;
            });
        }
        
        // --- WATER HISTORY FUNCTIONS (CORRECTED) ---
        function fetchWaterHistory() {
            fetch('/api/irrigation_history')
                .then(response => response.json())
                .then(data => {
                    if (data && data.length > 0) {
                        renderWaterChart(data);
                    } else {
                        console.log("No irrigation history to display.");
                    }
                });
        }
        function renderWaterChart(data) {
            if(waterHistoryChart) waterHistoryChart.destroy();
            const ctx = document.getElementById('waterHistoryChart').getContext('2d');
            waterHistoryChart = new Chart(ctx, { type: 'bar', data: { labels: data.map(d => new Date(d.start_time).toLocaleDateString()), datasets: [{ label: 'Water Volume (Litres)', data: data.map(d => d.total_volume_liters), backgroundColor: '#2e7d32' }]}});
        }

        // --- All other functions (plant simulation, downloads, forms) remain the same ---
        
        // --- EVENT LISTENERS ---
        document.addEventListener("DOMContentLoaded", () => {
            showPage('dashboard');
            updateDashboard(); // Run once on load
            setInterval(updateDashboard, 5000); // Fetch new data every 5 seconds
            
            // --- All other event listeners for buttons and forms remain the same ---
        });
    </script>
</body>
</html> -->

